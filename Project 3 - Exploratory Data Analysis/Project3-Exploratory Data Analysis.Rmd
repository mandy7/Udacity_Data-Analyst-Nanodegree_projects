Project 4 - Explore and Summarize Data
========================================================

This is an R Markdown document.
I am hereby penning down my thoughts / reflections about this project and my code.

To start with, I am an ardent football fan with most of my free time spent either playing football or watching football. If not this, then I play PC football game - FIFA.

Therefore, I have decided to use FIFA15 data as my working data.

**About the dataset**

- Number of observations - 12,236
- Number of Variables - 60
- *Variables description are as follows*

- $ Club.Name
- $ Nation        
- $ League        
- $ SearchName    = Player name
- $ position      = playing position
- $ Rating        = FIFA rating (out of 100)
- $ Category      
- $ Skill         = skill rating
- **next few variables are to measure skillsets**
- $ awr           
- $ dwr           
- $ PreferredFoot 
- $ weakfoot      
- $ Height        
- $ CommonName    
- $ statsid       
- $ Position      
- $ Rare          
- $ Attr1         
- $ Acceleration  
- $ SprintSpeed   
- $ Attr2         
- $ Positioning   
- $ Finishing     
- $ ShotPower     
- $ LongShot      
- $ Volleys       
- $ Penalties     
- $ Attr3         
- $ TactAware     
- $ Vision        
- $ ShortPass     
- $ LongPass      
- $ Curve         
- $ Crossing      
- $ FKAcc         
- $ Attr4         
- $ BallControl   
- $ Dribbling     
- $ Balance       
- $ Agility       
- $ Reactions     
- $ Attr5         
- $ Marking       
- $ Interceptions 
- $ StandingTackle
- $ SlideTackle    
- $ HeadingAcc     
- $ Attr6          
- $ Strength       
- $ Jumping        
- $ Aggression     
- $ Stamina        
- $ Potential      
- $ GKDiving       
- $ GKHandling     
- $ GKKicking      
- $ GKPositioning  
- $ GKReflexes     
- $ playerID      
- $ statsid.1     


**Univariate Exploration**

Let's set the working directory and import our dataset.

``` {r summarize dataset}
#Setting working directory
setwd("/Users/madua/Desktop")
#Fetching the data
fifa <- read.csv("fifa15.csv")

str(fifa)
summary(fifa)
```

As depicted by structure of this dataset, we have both categorical and numeric variables. Therefore there is no need to add extra categorical variable

Let's find if there are any duplicates in our dataset

```{r duplicates}
#Finding duplicates
duplicates <- duplicated(fifa$SearchName)
duplicate_players <- fifa[duplicates==TRUE,]
duplicate_players$SearchName
```

Let's see position wise distribution of duplicate players
```{r position-duplicate}
table(duplicate_players$position)
```

In football, its common that we have same players playing on different positions, depending on tactics. We can use below mentioned code to establish this fact

```{r multi-position players}
realduplicates <- duplicated(fifa$playerID)
realduplicate_players <- fifa[realduplicates==TRUE,]
realduplicate_players$SearchName
```
Again distributing this position wise
```{r position}
table(realduplicate_players$position)
```

Verifying our hypothesis of multi-position players by using example of player named - Arjen Robben

```{r verify multiosition}
multipositions_players <- realduplicate_players
Robben <- multipositions_players[multipositions_players$SearchName == "Arjen Robben",]
table(Robben$position)
```

This dataset has multiple leagues, so lets plot a barchart to see number of players belonging to different leagues
```{r league wise players plot}
plot(fifa$League,type="h",horiz=T, main = "League wise players division")
```


**Univariate Analysis**


**What is the structure of your dataset?**

There are 12,236 players in the dataset with 60 features (country, league, club, playing position, rating, skills etc). 

**Other observations:**

There are 237 rows of data involving same name players
Out of these, 87 players are same i.e. they are multi-position players so repeated
Leagues of England has highest number of players with almost double than second most populous league
Spain's league - Liga BBVA has the highest mean rating of 95 - perhaps an indicator of good quality of league

**What is/are the main feature(s) of interest in your dataset?**

The main features in the data set are various skills of a player and his playing position. I???d like to determine which skills are important to predict a rating of a player. At the same time it is interesting to observe which league has attacking mindset or a defensive mindset

**Did you create any new variables from existing variables in the dataset?**

I created a variable - "Mindset" to evaluate players' intent whether he prefers attack or defence, basis his playing position


**Bivariate Plots**

Football is a sport of 11 players, which means there are atleast 11 different positions for any single player. Now I will create a new column called **"Mindset"** which represents mindset of a player basis his playing position i.e. **Attack** if he is playing in advanced position else **Defence**

```{r mindset}
#creating mindset of players i.e. attack or defence
library(data.table)
DT <- data.table(fifa)
DT[,mindset := ifelse(position %in% c("CAM", "CF",  "CM", "LF",  "LM",  "LW", "RF",  "RM", "RW",  "ST"), "Attack", "Defence")]
fifa <- DT
```

In this dataset we have multiple leagues, belonging to different countries. Let's narrow down our data to top 5 leagues of the world (which belongs to England, France, Germany, Italy and Spain)

```{r top 5 leagues}
#Selecting top 5 leagues
library(dplyr)
Big5 <- c("Barclays Premier League","Ligue 1","Bundesliga","TIM Serie A","Liga BBVA" )
Topleagues <- filter(fifa, League %in% Big5)
str(Topleagues)
```

Let us plot mindset of the players belonging to these top 5 leagues. By doing this we will be able to understand that which nation's league plays more offensive football comparing to others.

```{r mindset plot}
#visualizing mindset grouped by leagues
d <- data.frame(column1 = Topleagues$League, column2 = Topleagues$mindset, Ratings = Topleagues$Rating)
require(lattice)
barchart(Ratings ~ column1,groups = column2, d,auto.key = list(columns = 3),main = "Mindset wise count of players belonging to top 5")
```

We have data corresponding to prefferred foot of a player as well. I would like to take an opportunity to create a Mosaic plot for the players belonging to different positions

```{r preferred foot plot}
#Position wise preferred foot
totals = table(fifa$PreferredFoot,fifa$position)

#creating custom palette
mypal <- c("black",   "red" ,    "green3" , "blue"   , "cyan"  ,  "magenta" ,"yellow"  ,"gray","pink", "purple", "springgreen", "magenta", "orange", "violet", "tan", "tomato", "cyan2", "thistle", "sienna", "plum4" )


#creating Mosaic plot
mosaicplot(totals,main="Positions wise preferred foot",xlab="PreferredFoot",ylab="Positions",color = mypal)
```

We had already seen players in various positions segmented by foot. 

Now just to satiate the curiousity, whether right footed players are rare or left footed. So Let's take a look at rare players segmented by Preferred foot.

```{r rare players-preferred foot plot}
#Rare players segmented by foot
library(vcd)
attach(fifa)
counts <- table(PreferredFoot,Rare)
spine(counts, main = "Rare players segmented by foot")
```

Almost both sets of players have similar rare players among them with Right footed players more on a higher rare side

```{r position-players}
#Segregating players based on their playing position
wingers <- fifa[fifa$position == c("LW","RW"),]
mid <- fifa[fifa$position == c("CM","LM","RM"),]
attacking_mid <- fifa[fifa$position == "CAM",]
defensive_mid <- fifa[fifa$position == "CDM",]
def <- fifa[fifa$position == c("CB","LB","RB","LWB","RWB"),]
gk <- fifa[fifa$position == "GK",]
striker <- fifa[fifa$position == c("ST","CF"),]
```

To establish relationship between striker and some of the main skills and league, I had plot following graph -

```{r striker skill plot}
pairs(~Rating + Finishing + ShotPower + Positioning + League, data = striker, main = "Basic skills of Striker")
```

Similarly smooth plot to confirm or deny whether strength is an important aspect for Defender

```{r smooth plot}
#Smooth plot to relate strength and rating of a defender
with(def,smoothScatter(Rating, Strength , main="Scatterplot of Strength vs. Defender Rating"))
```
Before moving to multivariate segment, I would quicly like to explore few more datapoints such as corelation between certain fields and some more observations

```{r maximum rating}
f <- fifa
#to find maximum rating within each league
aggregate(Rating~League, f, max)
#to find maximum rating within each league, segmented by position
aggregate(Rating~League + position, f, max)
```

There can be a possibility that player with good sprint speed can have a good rating. Let's establish corelation between these two parameters

```{r corelation}
#corelation between Sprintspeed and rating
cor(f$SprintSpeed,f$Rating)
```

As we can see, there is not much co-relation between the two factors. Guess it would take much more to be a good player thanjust a good speed
Let's explore what it takes to be a good goalkeeper

```{r corelation2}
cor.test(gk$Rating,gk$GKHandling)
```

So as depicted by result, a good handling capability can make up a good goalkeeper

Following few commands are to create a table and have view of some of the parameters - 

```{r additional queries}
table(f$League)
table(f$Nation,f$League)
table(f$position,f$Club.Name)
summary(table(f$League))
footpos <- table(f$position,f$PreferredFoot)
prop.table(footpos, margin=1)
```

**Bivariate Analysis**

**Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?**
For each position, there are certain skills which are strongly corelated and thus define the rating of a player. For e.g Striker is defined by his finishing skills as well as his shot power. For goalkeepers it is the handling of ball which strongly corelates with their rating. At the same time, against common notion, strength is not an important factor for defender 


**Multivariate plots**

As we have seen, there are multiple skills on which rating of a player is dependent. Hence let's focus on key skills for each position e.g. finishing for striker, tackling for defender etc.

Also to make plot less cluttered, I'll be analysing english league i.e. Barclays premier league only

```{r analyzing BPL}
#Analyzing Barclays Premier League
BPL <- fifa[fifa$League == "Barclays Premier League",]

#Collecting data for certain skills only
BPL_refined <- subset(BPL,,c(1,5,20,23,24,30,38,49,55))
team_wise_mean <- aggregate(.~Club.Name,data = BPL_refined,mean)
```

Let's create star plot to visualize team wise mean value for 7 top skills

```{r star plot}
#Creating star plot
require(grDevices)
stars(team_wise_mean[, 3:9], locations = c(0, 0), radius = FALSE, key.loc = c(0, 0), main = "Players skills", lty = 2)
```

It's worth to watch how rating and other skills are co-related for a player

```{r english players}
#Selecting ratings and few key skills for English league players
BPL_updated <- subset(BPL,,c(6,20,23,24,30,38,49,55))
```

```{r correlogram}
#Creating correlogram for skills of English league players
library(corrgram)
corrgram(BPL_updated, order=TRUE, lower.panel=panel.shade,upper.panel=panel.pie, text.panel=panel.txt,main="Correlogram of BPL players parameters")
```

**Modeling**

Before ending my analysis, I would like to create two models - GLM to predict any new player ratings basis his skills value and clustering to form cluster of similiar type players

```{r modeling}
#linear modeling
lm(Rating~GKHandling,gk)
gkmodel <- lm(Rating~GKHandling,gk)
lm(Rating~GKHandling + GKDiving + GKReflexes,gk)
lm(Rating~GKHandling + GKDiving + I(GKReflexes^2),gk)
gkmodel2 <- lm(Rating~GKHandling + GKDiving + I(GKReflexes^2),gk)
gkmodel3 <- update(gkmodel2, ~.+GKPositioning,gk)
newgk <- data.frame(GKHandling = c(88,76,58))
newgk$predictions <- predict(gkmodel,newgk,interval = "prediction")
newgk
```

In the above example, I created a model to predict Goalkeeper rating basis on value of some of skills specific to Goalkeeper, that are - handling, positioning, reflexes and Diving


It's always an interesting task to unearth players which are similar to other top players. So following is the clustering model to cluster top strikers, midfielders, defenders and goalkeepers. By top, I mean the ones having overall rating of 80 and above

```{r clustering}
#clustering
top <- f[which(f$Rating > 79),]

st <- top[top$position == "ST",]
st2 <- subset(st,,c(4,17:58))
stgrp <- hclust(dist(st2))
plot(stgrp,labels = st2$SearchName)

cb <- top[top$position == "CB",]
cb2 <- subset(cb,,c(4,17:58))
cbgrp <- hclust(dist(cb2))
plot(cbgrp,labels = cb2$SearchName)

cm <- top[top$position == "CM",]
cm2 <- subset(cm,,c(4,17:58))
cmgrp <- hclust(dist(cm2))
plot(cmgrp,labels = cm2$SearchName)

gk <- top[top$position == "GK",]
gk2 <- subset(gk,,c(4,17:58))
gkgrp <- hclust(dist(gk2))
plot(gkgrp,labels = gk2$SearchName)
```

**OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model**

Yes, I have created a linear model for Goalkeepers. Verifying the data for the same this model appears to  be efficient. The use of this model can be extended to other positions as well. Such model forms the basis of predicting possible ratings of underdeveloped talent.

In addition, I've also created clustering of top players and judging the players' playing type and clusters, I guess decent job had been done

**Final Plots and Summary**

**Plot 1**

```{r plot1}
#Position wise preferred foot
totals = table(fifa$PreferredFoot,fifa$position)

#creating custom palette
mypal <- c("black",   "red" ,    "green3" , "blue"   , "cyan"  ,  "magenta" ,"yellow"  ,"gray","pink", "purple", "springgreen", "magenta", "orange", "violet", "tan", "tomato", "cyan2", "thistle", "sienna", "plum4" )


#creating Mosaic plot
mosaicplot(totals,main="Positions wise preferred foot",xlab="PreferredFoot",ylab="Positions",color = mypal)
```

**Description 1**

This plot gives an interesting insight into players foot and their playing position. When forming a team (virtually or in reality), players foot become an important aspect as basis on which inside run, cross type, tackle etc. decided

**Plot 2**

```{r plot2}
#Relation between trikers skills
pairs(~Rating + Finishing + ShotPower + Positioning + League, data = striker, main = "Basic skills of Striker")
```

**Description 2**

This plot gives us a hint to look out for certain skills of striker in order to measure his ratings

**Plot 3**

```{r plot3}
#to understand current and potential ratings for England's clubs
englishclubs <- subset(BPL,,c(1,6,53))
team_wise_ratings_mean <- aggregate(.~Club.Name,data = englishclubs,mean)

#creating custom palette
mypal <- c("black",   "red" ,    "green3" , "blue"   , "cyan"  ,  "magenta" ,"yellow"  ,"gray","pink", "purple", "springgreen", "magenta", "orange", "violet", "tan", "tomato", "cyan2", "thistle", "sienna", "plum4" )

#creating scatterplot to understand current mean rating of a team and mean potential rating for English clubs
plot(team_wise_ratings_mean$Rating,team_wise_ratings_mean$Potential,pch =16, col = mypal,main = "English clubs current vs. potential ratings")
legend('topleft',paste(team_wise_ratings_mean$Club.Name),col=mypal,pch=16)
```

**Description 3**

This plot give us an insight into mean ratings of currently playing 20 teams in barclays premier league and their potential ratings. While selecting a team initially in the game, one can opt for team with higher potential rating thus having a brighter chances of better future players



**Reflection**

This dataset is of details about players in  FIFA 15 game. I started by understanding the individual variables in the data set, and then I explored interesting questions and leads as I continued to make observations on plots. 

Initially there were few challenges -

- Duplicate values
- Some NAs

Post data cleansing, it became an interesting task to analyse this data step by step

I started with complete data, followed by observing top 5 leagues, then exploring the data position wise and finaly sticking to one particular league -  Barclays premier league 

This top down approach helped me in better understanding the data

During this exploratory analysis, I created linear model and did clustering of players as well