---
title: "Exploratory Data Analysis"
output: html_document
---


```{r global_options}
knitr::opts_chunk$set(fig.width=10, fig.height=8, fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE,cache = TRUE)
```

**About the dataset & Project**
To start with, I am an ardent football fan with most of my free time spent 
either playing football or watching football. 
If not this, then I play PC football game - FIFA.

Therefore, I have decided to use FIFA15 data as my working data.

This dataset consists Fifa15 (a PC game) data, which has 12,236 observations 
across 60 variables. Most of these variables are around players' skills.
These skills are distributed across 5 major attributes - "Speed", "Shooting",
"Passing", "Technical", Defending" and "Others"

Besides skills, the data also has players names, their nationality, 
preferred foot and the leagues in which they play


```{r}
## Setting directory and reading data
setwd("/Users/madua/Desktop")
fifadata <- read.csv("fifa15.csv")
str(fifadata)
```



```{r, eval=FALSE}
summary(fifadata)
```


##UNI-VARIATE GRAPHS##

It would be interesting to see the distribution of players across various leagues

```{r playerdistribution, echo=FALSE}
# Plotting League wise distribution of the players
totalplayers <- table(fifadata$League)
graph1 <- barplot(totalplayers,cex.names = .4, cex.axis = 0.6, las = 2)
mtext(side = 1, at = graph1, text = totalplayers, line = -10, cex = 0.4)
```

* The top 3 leagues (basis players distribution) - Football league championship,
Barclays Premier League (England) and TIM Seris A (Italy). 
* Interestingly, most players are playing in England 
* USA, despite not being a football popular destination, is on 5th place


Sticking to Leagues only, let's see mean of the ratings across various leagues
```{r ratingdistribution, echo=FALSE}
# Plotting League wise mean ratings of players 
leaguerating <- aggregate(fifadata[, 6], list(fifadata$League), mean)
colnames(leaguerating) <- c("League", "Mean rating")
plot(leaguerating,cex.names = .4, cex.axis = 0.8, las = 2,horiz = T)
```

* Interestingly, Ukraninan league has the highest mean rating - around 75
* Major leagues (English, Spanish, French, Italian) are between 70-75


Another interesting observation would be to measure mean rating across multiple playing positions
```{r positionwiseratings, echo=FALSE}
# Plotting Position wise mean ratings of players 
positionrating <- aggregate(fifadata[, 6], list(fifadata$position), mean)
colnames(positionrating) <- c("Position", "Mean rating")
plot(positionrating,cex.names = .8, cex.axis = 0.8, las = 2)
```


* Most of the attacking positions - Striker, attacking midfielder have rating over 66
* Whearas defensive positions - Defenders, Goalkeepers have rating below 66
* Right Forward(RF) is way above and Left Winger Back (LWB) is way below.
The reason can be very few players on these positions. More on this ahead

We also have preferred foot - 'Left' or 'Right'. 
Let's distribute the players accordingly
```{r playingfoot, echo=FALSE}
# Plotting Prefferred foot wise distribution of the players 
foottype <- table(fifadata$PreferredFoot)
graph4 <- barplot(foottype,cex.names = .8, cex.axis = 0.8, las = 2, main = "Foot wise distribution", xlab = "Preferred foot", ylab = "Players count")
mtext(side = 1, at = graph4, text = foottype, line = -6)
```

Interestingly Right footed players are thrice of left footed


Now distributing players according to position
```{r playingpositions, echo=FALSE}
# Plotting Playing position wise distribution of the players 
positiontype <- table(fifadata$position)
graph5 <- barplot(positiontype, main = "Position wise player distribution", 
                  ylab = "player count", xlab = "Position", cex.names = .6, 
                  cex.axis = 0.8, las = 2)
mtext(side = 1, at = graph5, text = positiontype, line = -6, cex = 0.6)
```

This plot showcased clear picture across various postions - 

* Centre Backs(CB) and Strikers(ST) are major playing positions
* Centre Midfield(CM) and Goalkeepers(GK) are on 3rd and 4th position
* As suspected earlier, we have very less players on RF and LWB

In this data, we have current ratings of the players, 
as well as the potential future ratings. 
It will be interesting to oberve, how ratings will shift in the future
```{r ratings, echo=FALSE}
totalratings <- table(fifadata$Rating)
futureratings <- table(fifadata$Potential)
```

Current ratings 
```{r ratingwiseplayers, echo=FALSE}
# Plotting Rating wise distribution of the players 
barplot(totalratings, main = "Rating wise player distribution",
        xlab = "Ratings(out of 100)", ylab = "Number of players", 
        col = "blue")
```

Potential ratings
```{r potentialratingwiseplayers, echo=FALSE}
# Plotting Potential Rating wise distribution of the players
barplot(futureratings, main = "Potential rating wise player distribution", 
        xlab = "Ratings(out of 100)", ylab = "Number of players", 
        col = "yellow3")
```


Overlapping Current & future ratings
```{r potentialratingoverrating, echo=FALSE}
# Plotting Rating wise distribution of the players 
barplot(totalratings, main = "Rating wise player distribution",
        xlab = "Ratings(out of 100)", ylab = "Number of players", 
        col = "blue")
par(new = "TRUE")
# Plotting Potential Rating wise distribution of the players
barplot(futureratings, main = "Rating wise player distribution", 
        xlab = "Ratings(out of 100)", ylab = "Number of players", 
        col = "yellow3")
```

The future ratings are slightly on the higher side, reflecting players will grow eventually


**Univariate Analysis**

**What is the structure of your dataset?**
There are 12,236 players in the dataset with 60 features.
Most of these variables are around players' skills.
These skills are distributed across 5 major attributes - "Speed", "Shooting",
"Passing", "Technical", Defending" and "Others"

Besides skills, the data also has players names, their nationality, 
preferred foot and the leagues in which they play

Other observations:

* Most players are playing in England 
* Right footed players are thrice of left footed
* Centre Backs(CB) and Strikers(ST) are major playing positions
* Ukraninan league has the highest mean rating - around 75
* Major leagues (English, Spanish, French, Italian) are between 70-75
* Most of the attacking positions - Striker, attacking midfielder have rating over 66
* Whearas defensive positions - Defenders, Goalkeepers have rating below 66

**What is/are the main feature(s) of interest in your dataset?**
At present, skills and positions seems to be interesting feature. Just like in reality, various positions require different skills. Similarly there can be multiple factors, determining the overall rating of the player. I will explore the relation between Position and skills, as well as Rating and multiple skills in next section

**What other features in the dataset do you think will help support your investigation into your feature(s) of interest?**
Nationality can impact rating. For example, Brazilian players are much more talented than their Asian counterparts. Similarly Preferred Foot (Right or Left) can affect playing position, rating etc.

Did you create any new variables from existing variables in the dataset?
I've created a variable - 'Mindset' depending on the playing positions of the players. This variable will determine whether player prefers to attack or defend. More on it in Bi-variateanalysis

Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
None so far. The distribution seems on expected lines



**BI-VARIATE PLOTS**

This data has Nationality as another feature. Let's explore the same.
Plotting players distribution across various nations

```{r playerspernation, echo=FALSE}
# Plotting Nationality wise distribution of the players
playerspernation <- table(fifadata$Nation)
playerspernation <- as.data.frame.table(playerspernation)
colnames(playerspernation) <- c("country","Player count")
library(rworldmap)
sPDF <- joinCountryData2Map(playerspernation, joinCode='NAME', 
                            nameJoinColumn='country' , verbose='TRUE')
library(RColorBrewer)
colourPalette <- brewer.pal(7,'RdPu')
mapCountryData(sPDF, nameColumnToPlot="Player count", 
               colourPalette=colourPalette)
```

The world map show large amount of players in this dataset belongs to Europe and South America

Exploring mean ratings across various nations

```{r ratingspernation, echo=FALSE}
# Plotting Nation wise mean ratings of players 
Nationrating <- aggregate(fifadata[, 6], list(fifadata$Nation), mean)
colnames(Nationrating) <- c("country", "Mean rating")
sPDF <- joinCountryData2Map(Nationrating, joinCode='NAME', 
                            nameJoinColumn='country' , verbose='TRUE')
mapCountryData(sPDF, nameColumnToPlot="Mean rating", 
               colourPalette=colourPalette)
```

* As expected South american nations - Brazil, Argentina dominates rating
* Interestingly, an African nation - Ghana, Ivory Coast are also on high end of rating spectrum
* Lowest rating of nation = 55.3 while highest rating = 76, so still quite a disparity ;)


Usually we relate particular playing position wth skills like - 

* Good Goalkeeper with good reflexes
* Good defender with good height
* Good midfielder with good vision to pass the ball
* Good striker with good shooting abilities

Let's plot graph around these common assumptions

```{r GKreflexesVSrating, echo=FALSE}
# Corelating Goalkeeper reflexes and rating
GK <- fifadata[fifadata$position == "GK",]
library(plyr)
var1 <- tapply(GK$Rating, cut(GK$GKReflexes, seq(50, 100, by=10)), mean)
graph10 <- barplot(var1, main = "Mean ratings of Goalkeeper vs. Reflexes", 
                  xlab = "Reflexes(out of 100)", ylab = "Mean Rating")
mtext(side = 1, at = graph10, text = round(var1,digits = 2), line = -10, 
      cex = 1)
```

As reflexes increases, ratings increased


```{r CBheightVSrating, echo=FALSE}
# Corelating Central Defender height and rating
CB <- fifadata[fifadata$position == "CB",]
var2 <- tapply(CB$Rating, cut(CB$Height, seq(150, 200, by=10)), mean)
graph11 <- barplot(var2, main = "Mean ratings of Central Defender vs. Height", 
                  xlab = "Height(in cm)", ylab = "Mean Rating", col = "maroon")
mtext(side = 1, at = graph11, text = round(var2,digits = 2), line = -10, 
      cex = 1)
```

Height, unexpectedly, is not a major factor in defenders' ratings



```{r CMvisionVSrating, echo=FALSE}
# Corelating Central Midfielder Vision and rating
CM <- fifadata[fifadata$position == "CM",]
var3 <- tapply(CM$Rating, cut(CM$Vision, seq(50, 100, by=10)), mean)
graph12 <- barplot(var3, main = "Mean ratings of Central Midfielder and Vision", 
                  xlab = "Vision(out of 100)", ylab = "Mean Rating", 
                  col = "purple")
mtext(side = 1, at = graph12, text = round(var3,digits = 2), line = -10, 
      cex = 1)
```



```{r STpowerVSrating, echo=FALSE}
# Corelating Striker shot power and rating
ST <- fifadata[fifadata$position == "ST",]
var4 <- tapply(ST$Rating, cut(ST$ShotPower, seq(50, 100, by=10)), mean)
graph13 <- barplot(var4, main = "Mean ratings of ST vs. ShotPower", 
                  xlab = "ShotPower(out of 100)", ylab = "Mean Rating", 
                  col = "pink")
mtext(side = 1, at = graph13, text = round(var4,digits = 2), line = -10, 
      cex = 1)
```

The above 2 graphs proves our hypothesis
Vision and Shooting power corelates to midfielder and striker respectively

```{r playerstypes, echo=FALSE}
#Segregating players based on their playing position
fifa <- fifadata
wingers <- fifa[fifa$position == c("LW","RW"),]
mid <- fifa[fifa$position == c("CM","LM","RM"),]
attacking_mid <- fifa[fifa$position == "CAM",]
defensive_mid <- fifa[fifa$position == "CDM",]
def <- fifa[fifa$position == c("CB","LB","RB","LWB","RWB"),]
gk <- fifa[fifa$position == "GK",]
striker <- fifa[fifa$position == c("ST","CF"),]
```



```{r Strengthplot, echo=FALSE}
#Smooth plot to confirm or deny whether strength 
#is an important aspect for Defender
with(def,smoothScatter(Strength, Rating , 
                       main="Scatterplot of Strength vs. Defender Rating"))
```

Earlier we saw that height does not corelate to Defenders' ratings
Another important factor while defending can be the strenth of the player.
The above graph showcased this relation. 
Barring few anamolies, there is a positive corelation between strength and rating


Next, take a look around players from different positions and their preferred foot

```{r PreferredFoot2, echo=FALSE}
# Mosaic plot
totals = table(fifa$PreferredFoot,fifa$position)
mypal <- c("black",   "red" ,    "green3" , "blue"   , "cyan"  ,  "magenta" ,
           "yellow"  ,"gray","pink", "purple", "springgreen", "magenta", 
           "orange", "violet", "tan", "tomato", "cyan2", "thistle", 
           "sienna", "plum4" )
mosaicplot(totals,main="Positions wise preferred foot",xlab="PreferredFoot",
           ylab="Positions",color = mypal, cex.axis = 0.5)
```

The mosaic plot, though clutterred, gave few ideas into positions like - 

* Most of the left back, left midfielders are left footed
* Mostly players on the right flank of the pitch are right footed
* Strikers, defenders and goalkeepers are right footed majorly

The above results seem on regular lines and thus wont be investigating them further

Now coming back to skills of the players. Let's explore some skills and their relation with the players ratings

```{r SpeedVsRating, echo=FALSE, cache=FALSE}
# Corelating Ratings & Speed Attributes
library(plotly)
plot_ly(data = fifadata, x = Speed.attributes, y = Rating, 
        mode = "markers")
```
Speed does not seems to be much corelated with the ratings

```{r HeightVsRating, echo=FALSE}
# Ploting relationship between Height and Rating
library(lattice)
dotplot(Rating ~ Height, data = fifadata)
```
Similarly Height and ratings have no corelation

The above two graphs displayed the importance of other skills like shooting, passing, heading etc. in developing a player


In this dataset we have a feature called - 'Skill' This feature measures ability of the players,on the scale of (1-5), to perform acrobatic skills. 1 being very basic skills and 5 being very acrobatic like bicycle kick

In the following plot, we will see impact of skill on ratings
```{r SkillVsRating, echo=FALSE}
# Visualize relation between Skill and Rating
stripplot(Skill ~ Rating, data = fifadata)
```

* As expected 5 star skill gives you the gaurantee of good rating
* Interestingly, some of the 4 star players have better ratings than 5 star players


Sticking to 'skill' feature,  we will try to see the skill distribution across various positions
```{r SkillVsPosition, echo=FALSE, cache = FALSE}
# Plot to understand skill levels of players at various position
plot_ly(data = fifadata,x=position,y = Skill ,color = Skill,mode = "markers")
```
* As expected, attacking positions like strikers, wingers, attacking midfielders have 5 star skill players
* Goalkeepers, expectdly, are of 1 star skills


It would be interesting to observe rating distribution among various positions
```{r PositionVsRating, echo=FALSE}
# Box plot to visualize position wise rating distribution
bwplot(Rating ~ Position, data = fifadata, ylab = "Position", 
       xlab = "Rating", main = "Position wise rating distribution")
```

* Attacking midfielder(CAM) has the highest mean rating
* There are lots of outliers in major defending (CB) and attacking (ST) positions
* Goalkeeper (GK) has great distribution among the ratings, depicting disparity among them



```{r HeighVsHeading, echo=FALSE}
# Visualize relation between Height and HeadingAcc
dotplot(HeadingAcc ~ Height, data = fifadata)
```
We have seen that height does not have much impact on overall rating of the players. However there is one area where height should be useful - 'Heading' The same is been depicted in above plot where height and heading ability are strongly positive corelated

Before ending this Bi-variate analysis, we will quickly observe certain skills specific to positional attributes

```{r Speed.attributesVsSprintSpeed, echo=FALSE}
# Visualize relation between Speed.attributes and SprintSpeed
xyplot(Speed.attributes ~ SprintSpeed, data = fifadata, col = "pink")
```
Sprint speed is highly corelated with speed ability

```{r ShootingVsFinishing, echo=FALSE}
# Visualize relation between Shooting.attributes and Finishing
xyplot(Shooting.attributes ~ Finishing, data = fifadata, col = "black")
```
Finishing seems to be an important aspect for shooting


```{r ShootingVsPositioning, echo=FALSE}
# Visualize relation between Shooting.attributes and Positioning
xyplot(Shooting.attributes ~ Positioning, data = fifadata, col = "black")
```
Positioning appears to be another factor for strikers when they are shooting

```{r ShootingVsPenalties, echo=FALSE}
# Visualize relation between Shooting.attributes and Penalties
xyplot(Shooting.attributes ~ Penalties, data = fifadata, col = "black")
```
Penalties, expectedly, loosely corelated with shooting abilities

```{r PassingVsShortPass, echo=FALSE}
# Visualize relation between Passing.attributes and ShortPass
xyplot(Passing.attributes ~ ShortPass, data = fifadata, col = "Blue")
```
ShortPass are strangely not that important in passing

```{r PassingVsLongPass, echo=FALSE}
# Visualize relation between Passing.attributes and LongPass
xyplot(Passing.attributes ~ LongPass, data = fifadata, col = "Blue")
```
LongPasses are an important feature of passing

```{r PassingVsCrossing, echo=FALSE}
# Visualize relation between Passing.attributes and Crossing
xyplot(Passing.attributes ~ Crossing, data = fifadata, col = "Blue")
```
Crossing is another important aspect of apssing


```{r TechnicalVsDribbling, echo=FALSE}
# Visualize relation between Technical.attributes and Dribbling
xyplot(Technical.attributes ~ Dribbling, data = fifadata, col = "Red")
```
Dribbling seems to be forming heart of the technical ability of the player


```{r TechnicalVsReactions, echo=FALSE}
# Visualize relation between Technical.attributes and Reactions
xyplot(Technical.attributes ~ Reactions, data = fifadata, col = "Red")
```
Reactions are almost unrelated to technical ability

```{r TechnicalVsBallControl, echo=FALSE}
# Visualize relation between Technical.attributes and BallControl
xyplot(Technical.attributes ~ BallControl, data = fifadata, col = "Red")
```
Ball control is another important aspect

```{r DefendingVsMarking, echo=FALSE}
# Visualize relation between Defending.attributes and Marking
xyplot(Defending.attributes ~ Marking, data = fifadata, col = "Green")
```
Marking as depicted above, just like in real life, an important factor in defending

```{r DefendingVsStandingTackle, echo=FALSE}
# Visualize relation between Defending.attributes and StandingTackle
xyplot(Defending.attributes ~ StandingTackle, data = fifadata, col = "Green")
```
Standing tachles also appear to be indispensible factor

```{r DefendingVsSlideTackle, echo=FALSE}
# Visualize relation between Defending.attributes and SlideTackle
xyplot(Defending.attributes ~ SlideTackle, data = fifadata, col = "Green")
```
Slide tackles are important factors, but strangely less corelated than standing tackles

```{r GKDivingVsGKReflexes, echo=FALSE}
# Visualize relation between GKDiving and GKReflexes
xyplot(GKDiving ~ GKReflexes, data = fifadata, col = "Yellow")
```
Reflexes seems to be important for Goalkeepers while diving

##Bivariate Analysis##

**Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?**
Various positions demand different skill sets

**Positions wise analysis** - 

* Reflexes appears to be important skill as 20 points increase in this skill can cause upto 20 points increase in mean ratings of Goalkeeper
* Strength appears to increase overall rating of the defender
* Vision appears to be important skill as 30 points increase in this skill can cause upto 20 points increase in mean ratings of midfielder
* Shot power appears to be important skill as 40 points increase in this skill can cause upto 30 points increase in mean ratings of striker


**Shooting** - 

* Finishing appears to be strong attribute in terms of shooting ability
* Positioning, though, appears to be important aspect in shooting but does not corelate strongly


**Passing** - 

* Short passes does not seems to be important parameter for passing
* Long passes, however, are better corelated for passing
* Crossing appears to be strongly corelated with passong skills


**Technical abilities** - 

* Dribbling appears to be very strongly corelated to technical ability of the player
* Reactions seems to be loosely corelated
* Ball Control, again, can be important aspect but loosely corelated


**Defending** - 

* Marking seems to be important aspect of defending
* Standing Tackle strongly corelated to defending
* Sliding Tackle seems to be important factor as well


**Overall Rating** - 

* Sprint speed is loosely corelated with overall ratings
* Height of a player does not corelate with overall ratings
* Height, however, can give an edge in heading abilities

**Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?**

* Nationality appears to be interesting factor in determing players count as well as mean ratings.
* South american nations - Brazil, Argentina dominates rating
* Interestingly, African nations - Ghana, Ivory Coast are also on high end of rating spectrum
* Lowest rating of nation = 55.3 while highest rating = 76, so still quite a disparity

**What was the strongest relationship you found?**

* Finishing seems to be strong variable for shooting. 
* Similarly, crossing skill in passing ability and marking in defending ability appears to be positively corelated
* Reflexes is an important skill for Goalkeepers





##MULTI-VARIATE PLOTS##

As we have seen that many skills can attribute to overall ratings of the players. Lets establish major attributes of the striker
```{r strikerskills, echo=FALSE}
#Plotting relationship between striker and some of the main skills and league
pairs(~Rating + Finishing + ShotPower + Positioning + League, data = striker, 
      main = "Basic skills of Striker")
```
Finishing, Positioning and shooting appears to be corelated with the striker's ratings but league has little impact on it.
This suggest we can have good strikers playing in the poor leagues as well - called as hidden gems

Trying something similar for Passing ability of a player
```{r passingskills, echo=FALSE}
library(corrgram)
Passingability <- subset(fifadata[,c(28:35)])
corrgram(Passingability, lower.panel=panel.pts,upper.panel=panel.conf,
         diag.panel=panel.density,cex.labels = 0.6)
```
The above corrgram plot has not showcase strong corelation in terms of passing ability, but individual skills are strongly corelated - TactAware and Vision, ShortPass and LongPass
This demonstrates skills can be interdependent on each other


Also we have seen major playing attributes - Speed, Shooting, Passing, Technical, Defending
Following plot will observe relation between these attributes and overall ratings of the players
```{r ratingVsattributes, echo=FALSE}
# Plotting effect of major playing attributes on rating
pairs(~Rating + Shooting.attributes + Speed.attributes + Passing.attributes 
      + Other.attribute + Defending.attributes + Technical.attributes, 
      data = fifadata, main = "Main attributes vs. Rating", cex.labels = 0.8)
```
While Shooting, Passing and Technical attributes seem to be major contributers.
Defending, unfortunately, is loosely corelated with overall rating


Basis on the playing position, player can contribute to the attack or defense of the team
Following code will create new variable - 'mindset', to segregate players into attack or 'defense', basis their playing positions
```{r mindset}
#creating mindset of players i.e. attack or defence
library(data.table)
DT <- data.table(fifa)
DT[,mindset := ifelse(position %in% c("CAM", "CF",  "CM", "LF",  
                                      "LM",  "LW", "RF",  "RM", "RW",  "ST"), 
                      "Attack", "Defence")]
fifa <- DT

#Selecting top 5 leagues
library(dplyr)
Big5 <- c("Barclays Premier League","Ligue 1","Bundesliga",
          "TIM Serie A","Liga BBVA" )
Topleagues <- filter(fifa, League %in% Big5)
```
In the same code atop, we have created top 5 leagues, basis mean ratings and players playing in those leagues (1 each from England, Spain, Germany, France and Italy) - 'Topleagues'
This will help us in focussed visualizion


```{r mindset_topleagues, echo=FALSE}
#visualizing mindset grouped by Top 5 leagues
library(ggplot2)
g <- ggplot(Topleagues, aes(mindset, Rating))
g + geom_point() + facet_grid(. ~ League)
```
The above dot plot shows various teams of 5 top leagues and their average mean rating across 'Attack' and 'Defence'

* Liga BBVA (Spanish League) has more team of attacking mindset
* Bundesliga (German League), on the contrary has most defensive teams among these 5 leagues
* English and Italian leagues teams are balanced in attack and defence


```{r meanattributes, echo=FALSE}
# Creating league wise mean of major football attributes 
attributedistribution <- aggregate(fifadata[, c(18,21,28,36,42)], 
                                   list(fifadata$League), mean)
colnames(attributedistribution) <- c("League", "speed", "shooting", 
                                     "passing", "technical", "defending")
```


Following graph will explore major playing attributes across top 5 leagues
```{r LeaguesVsMainattribute, echo=FALSE}
#Comparing major football attributes within Top 5 leagues
library(plotrix)
df <- filter(attributedistribution, League %in% Big5)
radial.plot(df[,2:6],rp.type="p",
            labels=c("speed", "shooting", "passing", "technical", "defending"),
            main="Playing Attributes (Mean)", label.prop = 1.2)
par(xpd=TRUE)
legend(20,20,df[,1],col=1:5,lty=rep(1,5),cex = 0.5)
par(xpd=FALSE)
```
Above star plot shows, superiority of Liga BBVA (Spanish League) over other 4 leagues in almost all departments


'Aggression' and 'Skill', both of these players attributes are tough to measure. Let's see their impact on Rating

```{r Aggression_Rating_Skill, echo=FALSE, cache= FALSE}
#Corelating Aggression, Rating and Skill for Top 5 leagues
library(plotly)
plot_ly(data = Topleagues, y = Aggression, x = Rating, color = Skill, 
        mode = "markers")
```
5 star skill players (yellow colored) are on higher end of rating while nothing definite can be said about aggression's impact on ratings


```{r VisionVsStandingTavkleVsDefending, echo=FALSE, cache=FALSE}
# Plotting role of Vision, DefendingAttribute vs. StandingTackle 
# in Defending.attribute of the plauer
plot_ly(data = fifadata, x = Vision, y = StandingTackle, 
        color = Defending.attributes, mode = "markers")
```
The above graph measured role of vision and standing tackle in forming Defending attributes of the players. As depicted in graph, vision does not have much say in forming defending attribute while standing tackle is an important aspect for the same



```{r AggressionVsDefendingVsPassing, echo=FALSE, cache=FALSE}
# Plotting role of Aggression in Defending attributes and Passing attributes
plot_ly(data = fifadata, x = Defending.attributes, 
        y = Passing.attributes,color = Aggression , mode = "markers")
```
Aggression does not seem to be high impacting feature in passing attribute of the player but plays important role in forming defending attribute of the player


```{r GKDivingVsGKReflexesVsGKPosition, echo=FALSE, cache=FALSE}
#Corelating GoalKeeper's Diving, Reflexes and Positioning
plot_ly(data = fifadata, x = GKDiving, y = GKReflexes,color = GKPositioning  , 
        mode = "markers")
```
GoalKeeper diving, reflexes and positioning are corelated, understandably


There's another variable - 'Work rate' to measure hardworking aspect of the player (on the scale of 1 to 3) It is further divided into Defensive work Rate - DWR and Attacking Work rate - AWR
```{r DefendingVsRatingVsDWR, echo=FALSE, cache=FALSE}
#Corelating Defending attributes, Rating and Defensive work rate
plot_ly(data = fifadata, x = Defending.attributes, y = Rating ,color = dwr , 
        mode = "markers")
```
The above graph corelates DWR with defensive attribute wand ratings. Yellow dots (high DWR) are mostly on the higher end of defending attributes but scatterred among Ratings end.
This depicts DWR has some impact on defending attribute, but not on rating


```{r ShootingVsRatingVsAWR, echo=FALSE, cache=FALSE}
#Corelating Shooting attributes, Rating and Attacking work rate
plot_ly(data = fifadata, x = Shooting.attributes, y = Rating ,color = awr , 
        mode = "markers")
```
Just like previous graph, this one compared AWR with Shooting attribute and Rating
Unexpectedly Yellow dots (high AWR) are scatterred over here, showcasing nil impaact of AWR on ratings or shooting abilities

Passing ability of a player is determined by number of factors. Pass type - Short or Long is one of that criteria
```{r ShortPassVsLongPassVsPassing, echo=FALSE}
# Helix graph to understand relationship between 
# ShortPass, LongPasss and Passing attribute
library(scatterplot3d)
scatterplot3d(fifa$Passing.attributes, fifa$LongPass, fifa$ShortPass, 
              highlight.3d = TRUE, col.axis = "blue",col.grid = "lightblue", 
              main = "Helix", pch = 20)
```
Though this helix graph is tough to comprehend but major trend which can be seen is that long passes have much more impact than short passing value on Passing ability of the player


We have not explored one variable so far - 'Rare' - This variable depicts how rare a player is (on scale of 1-9). The rarity is defined by the player's combination of existing skills
```{r PostionVsSkillVsRare, echo=FALSE,cache=FALSE}
# Plot to understand skill and 'Rare' levels of players at various position
plot_ly(data = fifadata, x = position, y = Skill ,color = Skill ,
        mode = "markers", size = Rare)
```
The above plot is an extension of bi-variate graph where we measured skill across positions. In this graph we are adding third variable- Rare (highlighted by size) to that.
Interestingly 5 star skill players are not that rare, highlighting that acrobatic skills are easier to possess. 
In terms of position, rare players are seen mostly on attacking front - Strikers, wingers, attacking midfielders



**Modeling**

Before ending my analysis, I would like to create two models - GLM to predict any new player ratings basis his skills value and clustering to form cluster of similiar type players

```{r GML, eval=TRUE}
#linear modeling
lm(Rating~GKHandling,gk)
gkmodel <- lm(Rating~GKHandling,gk)
lm(Rating~GKHandling + GKDiving + GKReflexes,gk)
lm(Rating~GKHandling + GKDiving + I(GKReflexes^2),gk)
gkmodel2 <- lm(Rating~GKHandling + GKDiving + I(GKReflexes^2),gk)
gkmodel3 <- update(gkmodel2, ~.+GKPositioning,gk)
newgk <- data.frame(GKHandling = c(88,76,68), GKDiving = c(75,66,58), GKReflexes = c(82,75,71), GKPositioning = c(84,77,70))
newgk$predictions <- predict(gkmodel3,newgk,interval = "prediction")
newgk
```

In the above example, I created a model to predict Goalkeeper rating basis on value of some of skills specific to Goalkeeper, that are - handling, positioning, reflexes and Diving


It's always an interesting task to unearth players which are similar to other top players. So following is the clustering model to cluster top strikers, midfielders, defenders and goalkeepers. By top, I mean the ones having overall rating of 80 and above

```{r clustering}
#clustering
top <- fifa[which(fifa$Rating > 79),]
st <- top[top$position == "ST",]
stgrp <- hclust(dist(st))
plot(stgrp,labels = st$SearchName, main = "Striker clusters")


cb <- top[top$position == "CB",]
cbgrp <- hclust(dist(cb))
plot(cbgrp,labels = cb$SearchName, main = "Defender clusters")

cm <- top[top$position == "CM",]
cmgrp <- hclust(dist(cm))
plot(cmgrp,labels = cm$SearchName, main = "Midfielder clusters")

gk <- top[top$position == "GK",]
gkgrp <- hclust(dist(gk))
plot(gkgrp,labels = gk$SearchName, main = "Goalkeeper clusters")
```


##Multivariate Analysis##


**Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?**
Finishing, Positioning and shooting appears to be corelated with the striker’s ratings but league has little impact on it

While Shooting, Passing and Technical attributes seem to be major contributers. Defending, unfortunately, is loosely corelated with overall rating

Vision does not have much say in forming defending attribute while standing tackle is an important aspect for the same

Aggression does not seem to be high impacting feature in passing attribute of the player but plays important role in forming defending attribute of the player


**Were there any interesting or surprising interactions between features?**
Aggression does not seem to be high impacting feature in passing attribute of the player but plays important role in forming defending attribute of the player. This is on parallel lines with real life football game as defenders are pretty aggressive while tackling and winning the balls, whearass midfielders are more of a technical skills

**OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.**
Yes, I created a general linear model to predict Goalkeeper rating basis on value of some of skills specific to Goalkeeper, that are - handling, positioning, reflexes and Diving.

Also position specific clusters are created to pair similiar styled players


##Final Plots and Summary##

**Plot One**
```{r playingpositions2, echo=FALSE}
# Plotting Playing position wise distribution of the players 
positiontype <- table(fifadata$position)
graph5 <- barplot(positiontype, main = "Position wise player distribution", 
                  ylab = "player count", xlab = "Position", cex.names = .6, 
                  cex.axis = 0.8, las = 2)
mtext(side = 1, at = graph5, text = positiontype, line = -6, cex = 0.6)
```

**Why this plot** - 
To begin any analysis, one should be aware of important variables in the dataset. In this dataset, most of the variables are around the skills, which can be explored as we go. Another important aspect is the playing position of the player. In the game, as well as in real life, it is important to have players playing on their preferred positions. So knowledge about positions is indispensible for any manager. Thus, I choose this graph to measure players count across various positions

**Key takeaways** -
This plot showcased clear picture across various postions - 
* Centre Backs(CB) and Strikers(ST) are major playing positions
* Centre Midfield(CM) and Goalkeepers(GK) are on 3rd and 4th position
* We have very less players on RF and LWB


**Personal Opinion** - 
This dataset matches real world database of football players where 30% of the players are either strikers or centre backs. The third position of centre midfield is again reflection of real world position preferences. As we streamlined playing positions - LWB, RWB etc. the count decreased drastically, However, unexpectedly, we have jus 1 Right forward and 3 left forward


**Plot Two**
```{r AggressionVsDefendingVsPassing2, echo=FALSE, cache=FALSE}
# Plotting role of Aggression in Defending attributes and Passing attributes
plot_ly(data = fifadata, x = Defending.attributes, 
        y = Passing.attributes,color = Aggression , mode = "markers")
```

**Why this plot** - 
Most of the features (playing skills) of a player can be reflected in his/her game. Also the same can be proved by the statistics / ratings. For e.g. 'Finishing' is an important aspect for the striker as well overall rating of the player. However there are some aspects which wont reflect in the stats but in the playing style of the player and very well decide the fate of the match. 'Aggression' is one such factor as this can come handy at the time of snatching the ball from the opponent. However over aggressive players can commit fouls, resulting in sending off from the match. Thus selected this plot to measure how aggressiveness is related to the skills

**Key takeaways** -
Aggression does not seem to be high impacting feature in passing attribute of the player but plays important role in forming defending attribute of the player


**Personal Opinion** - 
Defending attribute is composed of tackling, marking, interceptions etc. and these things requires little bit of aggression as player has to snatch the ball from the opponnent. Wheras passing aspect is more about varied range of passes, crosses, vision etc. and thus requires more about the ball control than the aggression. Thus graph aptly depicting aggression within defending attribute region




**Plot Three**
```{r LeaguesVsMainattribute2, echo=FALSE}
#Comparing major football attributes within Top 5 leagues
library(plotrix)
df <- filter(attributedistribution, League %in% Big5)
radial.plot(df[,2:6],rp.type="p",
            labels=c("speed", "shooting", "passing", "technical", "defending"),
            main="Playing Attributes (Mean)", label.prop = 1.2)
par(xpd=TRUE)
legend(20,20,df[,1],col=1:5,lty=rep(1,5),cex = 0.5)
par(xpd=FALSE)
```

**Why this plot** - 
Time over time, we compare leagues - sometimes to show financial disparity between them and sometimes to show difference in playing attributes. Mostly the comparison is based on top stars in various leagues. However, in this graph I wanted to compare mean score of top 5 leagues to truly measure their playing abilities. To make things fairer, this graph is measure across 5 major playing paramateres - Speed, Shooting, Passing, Technical, Defending

**Key takeaways** -
Above star plot shows, superiority of Liga BBVA (Spanish League) over other 4 leagues in almost all departments. In defense, Bundesliga (German League) is better than rest of the 4 leagues. Ligue 1 (French League) is the poor cousin of all and is below par than other leagues


**Personal Opinion** - 
Spanish league with some of the great skillsets players like Messi, Ronaldo, Neymar etc. definitely looks better than other leagues and is aptly shown in this graph. German league, despite having low star power and viewership performed well as per this plot. The fact, depicted by constant entries of German teams in European competitions. Also Germany's World cup victory further strengthen the fact of superior German league. French league, due to financial crisis, is rightly shown below par than other


**Miscellanious Plots**

**Plot4**

These plots are informative in understanding the data and polished. So thought to include them besides 3 top plots


```{r ratingspernation2, echo=FALSE}
# Plotting Nation wise mean ratings of players 
Nationrating <- aggregate(fifadata[, 6], list(fifadata$Nation), mean)
colnames(Nationrating) <- c("country", "Mean rating across nations")
sPDF <- joinCountryData2Map(Nationrating, joinCode='NAME', 
                            nameJoinColumn='country' , verbose='TRUE')
mapCountryData(sPDF, nameColumnToPlot="Mean rating across nations", 
               colourPalette=colourPalette)
```

* As expected South american nations - Brazil, Argentina dominates rating
* Interestingly, an African nation - Ghana, Ivory Coast are also on high end of rating spectrum
* Lowest rating of nation = 55.3 while highest rating = 76, so still quite a disparity ;)


**Plot5**
we have created top 5 leagues, basis mean ratings and players playing in those leagues (1 each from England, Spain, Germany, France and Italy) - 'Topleagues'
This will help us in focussed visualizion


```{r mindset_topleagues2, echo=FALSE}
#visualizing mindset grouped by Top 5 leagues
library(ggplot2)
g <- ggplot(Topleagues, aes(mindset, Rating))
g + geom_point() + facet_grid(. ~ League)
```
The above dot plot shows various teams of 5 top leagues and their average mean rating across 'Attack' and 'Defence'

* Liga BBVA (Spanish League) has more team of attacking mindset
* Bundesliga (German League), on the contrary has most defensive teams among these 5 leagues
* English and Italian leagues teams are balanced in attack and defence



##Reflection##

**General**
The Fifa15 data set contains information on about 12,000 players across the world which are part of EA Sports' FIFA15 game. 
I started this project by understanding the individual variables in the data set, and then I explored interesting questions and leads as I continued to make observations on plots. 
Existing knowledge of football also helped me in grasping the skills. Some of the results are on expected lines while others are surprising


**Interesting pointers**
Nationality appears to be interesting factor in determing players count as well as mean ratings. South american nations - Brazil, Argentina dominates rating. Interestingly, African nations - Ghana, Ivory Coast are also on high end of rating spectrum. Lowest rating of nation = 55.3 while highest rating = 76, so still quite a disparity

Finishing seems to be strong variable for shooting. Similarly, crossing skill in passing ability and marking in defending ability appears to be positively corelated. Reflexes is an important skill for Goalkeepers



**Surprises**
Defending ability of a player is not strongly corelated with ratings

Sprint speed does not have any impact on ratings


**Challenges**
Some of the players are playing on multiple positions. It was hard to drop them (or any particular position of theirs)
While plotting a map, nations names are not matching with worldmap database so altered the names


**Modelling**
Clustering of the players can be very useful as in real or virtual game we always want a cheaper player with huge potential. So similar playing skills can at times unearth future stars

**Next steps**
I would like to build a model to predict the chemistry (understanding) between the players. Chemistry can be dependent on players belonging to same nation, same style, same league etc.
